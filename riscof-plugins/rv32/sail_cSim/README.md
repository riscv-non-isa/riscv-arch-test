# Riscof Plugin for Sail RISC-V formal model

- Using the simulators from the Sail RISC-V formal model

The [Sail RISC-V formal model](https://github.com/rems-project/sail-riscv) generates two
simulators, in C and OCaml.  They can be used as targets for running tests using riscof.

For this purpose, the Sail model needs to be checked out and built on
the machine running the compliance suite.  Follow the build
instructions described the README for building the RV32 and RV64
models.  Once built, please add `$SAIL_RISCV/c_emulator` and
`$SAIL_RISCV/ocaml_emulator` to your path, where $SAIL_RISCV is the
top-level directory containing the model.

This plugin allows using the C Simulator generated by the SAIL model.

- Config file entry

```
# Name of the Plugin. All entries are case sensitive. Including the name.
[sail_cSim]

#path to the directory where the plugin is present
pluginpath=<path-to-plugin>

#path where the SAIL binaries are available. (optional)
#if this value is absent, it is assumed that the binaries are available as executables by default
PATH=<path-to-binaries>

#path to the ISA config file. (required if the plugin is used as DUT)
ispec=<path-to-isa-config>

#path to the Platform config file. (required if the plugin is used as DUT)
pspec=<path-to-platform-config>

#number of jobs to spawn in parallel (optional)
jobs=1

#the make command to use while executing the make file. Any of bmake,cmake,pmake,make etc. (optional)
#Default is make
make=make

#The following arguments are necessary only if executed through docker

#Flag indicating that the execution is through docker
docker=<True/False>

#Name of the docker image
image=<docker-image-name>
```

- Export command

```
pwd=pwd;export PYTHONPATH=$pwd:$PYTHONPATH;
```

- This plugin also supports coverage collection using ISAC.

## Using Docker with this plugin

- Setup

Ensure that docker is installed and configured properly before running this step.
Run the following command.
```
docker pull registry.gitlab.com/incoresemi/docker-images/compliance 
```

- Running with riscof

To use the docker image with the plugin the `sail_cSim` node in the `config.ini` must
contain the following values too.
```
# Name of the Plugin. All entries are case sensitive. Including the name.
[sail_cSim]
docker=True
image=registry.gitlab.com/incoresemi/docker-images/compliance
```

## References

- [Installing Docker](https://docs.docker.com/engine/install/) - Distro specific installation
  instructions and quirks are present on the same website. For example ubuntu specific instructions
  can be found [here](https://docs.docker.com/engine/install/ubuntu/).

- The docker file for the image can be found [here](https://gitlab.com/incoresemi/docker-images/-/blob/master/compliance/Dockerfile).

- The docker containers are hosted [here](https://gitlab.com/incoresemi/docker-images/container_registry/2205130).

